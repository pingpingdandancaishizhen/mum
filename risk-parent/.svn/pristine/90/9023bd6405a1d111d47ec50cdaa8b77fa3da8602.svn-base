<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.sunfit.risk.buz.server.dao.contract.ContractResourceDAO" >
	<resultMap id="ContractResourceMap" type="cn.sunfit.risk.buz.api.beans.contract.ContractResource" >
		<result column="id" property="id"/>
		<result column="corp_id" property="corpId"/>
		<result column="bp_id" property="bpId"/>
		<result column="temp_id" property="tempId"/>
		<result column="contract_no" property="contractNo"/>
		<result column="contract_name" property="contractName"/>
		<result column="contract_type" property="contractType"/>
		<result column="resource" property="resource"/>
		<result column="create_time" property="createTime"/>
		<result column="creator" property="creator"/>
		<result column="update_time" property="updateTime"/>
		<result column="updater" property="updater"/>
	</resultMap> 
	
	<select id="queryByBpId" parameterType="java.util.Map" resultMap="ContractResourceMap" >
		select id, corp_id, bp_id, temp_id,contract_no,contract_name, contract_type, resource, create_time, 
			creator, update_time
		from ${domain}_contract_resource
		where bp_id = #{bpId};
	</select>
	
	<insert id="addContractResource" parameterType="cn.sunfit.risk.buz.api.beans.contract.ContractResourceDTO" >
		insert into ${domain}_contract_resource (id, corp_id, bp_id, temp_id, contract_no,contract_name,
			contract_type, resource, status ,create_time, creator, update_time)
		values (#{id}, #{corpId}, #{bpId}, #{tempId}, #{contractNo},#{contractName},
			#{contractType}, #{resource}, '1', now(), #{creator}, now());
	</insert>
  
	<delete id="removeContractResourceByBp" parameterType="java.util.Map">
		delete from ${domain}_contract_resource where bp_id = #{bpId};
	</delete>
	
	<update id="signContract" parameterType="java.util.Map">
		update ${domain}_contract_resource set
			status = '2'
		where bp_id = #{bpId};
	</update>
	
	<select id="getByBpId" parameterType="cn.sunfit.risk.buz.api.beans.contract.ContractLoadReq" resultMap="ContractResourceMap" >
		select id, corp_id, bp_id, temp_id,contract_no,contract_name, contract_type, resource, create_time, 
			creator, update_time
		from ${domain}_contract_resource
		where bp_id = #{bpId}
			and contract_type = #{contractType}
		limit 1;
	</select>
	
</mapper>