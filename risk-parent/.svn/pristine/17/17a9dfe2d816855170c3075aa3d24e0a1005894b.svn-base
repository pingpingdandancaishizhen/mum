package cn.sunfit.risk.credit.server.util;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import org.apache.commons.httpclient.Cookie;
import org.apache.commons.httpclient.HttpClient;
import org.apache.commons.httpclient.NameValuePair;
import org.apache.commons.httpclient.methods.PostMethod;
import org.apache.commons.httpclient.params.HttpClientParams;
import org.apache.commons.httpclient.params.HttpMethodParams;
import org.apache.log4j.Logger;
import org.dom4j.Document;
import org.dom4j.DocumentHelper;
import org.dom4j.Element;
import org.dom4j.Namespace;
import org.dom4j.QName;

import orj.worf.util.ArrayUtils;
import orj.worf.util.StringUtils;

/**
 * 上海资信直连工具类 
 * 查询步骤：
 * 		1、模拟登录vpn
 * 		2、执行相应的接口
 * 注：需将jssecacerts拷贝到%JAVA_HOME%\jre\lib\security目录下
 */
public class NfcsUtil {

    private static Logger log = Logger.getLogger(NfcsUtil.class);
    // 以下参数由上海资信分配，一般是通过邮件发给快易信部门老大

    public final static String TMP_PATH = "temp/";
    public final static String FILE_EXTENSION = ".zip";

    // --------以下参数为固定参数--------
    private static String batchCreditWebServiceURI = ServerConfig.NFCS_URL_PREFIX + "/webservice/batchcredit?wsdl";
    private static String step1URI = "https://vpn.shanghai-cis.com.cn/+CSCOE+/logon.html";
    private static String step2URI = "https://vpn.shanghai-cis.com.cn/+webvpn+/index.html";

    static Cookie[] cookies = null;

    /**
     * 模拟登录VPN
     */
    /**
     * 模拟登录VPN
     */
    public static HttpClient getUrlContent() throws Exception {
        HttpClient httpClient = new HttpClient();
        HttpClientParams httparams = new HttpClientParams();
        httparams.setSoTimeout(30000);
        httpClient.setParams(httparams);

        httpClient.getHostConfiguration().setHost(ServerConfig.NFCS_HOST, ServerConfig.NFCS_PORT);

        PostMethod login = new PostMethod(step1URI);
        login.addRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        httpClient.executeMethod(login);

        cookies = httpClient.getState().getCookies();
        System.out.println("==========Cookies============");
        int i = 0;
        for (Cookie c : cookies) {
            System.out.println(++i + ":   " + c);
        }
        httpClient.getState().addCookies(cookies);

        PostMethod login2 = new PostMethod(step2URI);
        login2.addRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        login2.addRequestHeader("Refer", step1URI);
        login2.addRequestHeader(
                "Accept",
                "image/jpeg, application/x-ms-application, image/gif, application/xaml+xml, image/pjpeg, application/x-ms-xbap, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*");

        NameValuePair tgroup = new NameValuePair("tgroup", "");
        NameValuePair next = new NameValuePair("next", "");
        NameValuePair tgcookieset = new NameValuePair("tgcookieset", "");
        NameValuePair Login = new NameValuePair("Login", "登录");
        NameValuePair Email = new NameValuePair("username", ServerConfig.NFCS_USER_NAME);
        NameValuePair password1 = new NameValuePair("password", ServerConfig.NFCS_PASSWORD);

        NameValuePair[] data = { tgroup, next, tgcookieset, Login, Email, password1 };
        login2.setRequestBody(data);

        httpClient.executeMethod(login2);

        cookies = httpClient.getState().getCookies();
        System.out.println("==========Cookies============");
        int j = 0;
        for (Cookie c : cookies) {
            System.out.println(++j + ":   " + c);
        }
        httpClient.getState().addCookies(cookies);
        return httpClient;
    }

    public static void main(String[] args) throws IOException {
        String str = "75,3,4,20,0,8,0,8,0,-28,-115,-94,74,0,0,0,0,0,0,0,0,0,0,0,0,29,0,0,0,51,49,55,55,56,48,57,52,55,56,56,56,53,53,50,57,52,50,48,57,52,48,53,50,46,104,116,109,108,-19,28,-21,83,90,87,-2,123,103,-6,63,-36,-91,-77,95,118,6,-72,23,16,-111,0,-77,-102,104,116,-42,-41,24,58,-45,-18,-105,29,-126,87,101,-118,96,-127,110,-102,-39,-39,63,6,72,-101,-60,104,19,20,-108,-89,15,30,10,87,5,2,8,14,121,52,-90,105,-78,-42,-22,-76,73,71,19,109,59,123,-49,-27,117,-127,115,47,-113,96,55,-39,-28,-6,33,-36,115,126,-113,115,126,-81,-13,59,-65,115,79,100,127,-30,114,-115,38,-107,-63,36,-99,-64,85,-93,-72,-127,55,102,-46,114,-71,-118,15,63,-112,-11,42,7,-6,21,-78,-34,-18,-50,11,10,-103,-78,79,-39,-33,-83,-40,122,-23,127,-26,-5,41,-100,-67,-13,-44,121,20,-34,-120,-121,-110,1,-37,13,-25,83,25,63,-41,-5,-31,7,8,-7,-56,72,122,-13,-2,-11,101,-82,0,-59,-124,-63,31,-60,41,-65,64,28,-34,-74,-70,-29,15,-99,-63,-83,-7,-124,-57,-10,-56,-65,79,-47,-89,-128,7,-70,-107,-99,-56,-124,-55,52,-59,-59,63,-1,66,-13,79,-7,121,-67,-50,-124,-21,76,92,-27,-43,41,28,81,-25,94,-28,28,19,-2,-91,-119,63,97,-102,-44,-98,67,-44,19,42,-125,17,55,-55,47,118,-3,-115,83,32,98,52,93,-43,-30,-7,23,-16,116,34,-1,42,-67,-128,71,-39,-3,-119,-110,-85,28,-23,28,-68,-44,51,52,50,32,69,116,122,29,126,14,57,63,-44,63,52,34,69,62,66,-87,-25,92,14,-22,66,-9,-7,-95,-111,78,101,-33,-48,96,14,-84,68,-24,-33,-91,-97,93,67,23,62,-83,-28,-47,51,52,-88,-28,94,-22,-5,123,-73,20,-23,-104,50,-99,67,-6,-5,6,-69,-71,-67,-35,125,23,123,-107,82,4,19,-127,38,10,-92,-89,115,-96,-81,-1,83,41,-62,-39,-120,110,126,-49,57,119,89,-91,-2,108,-36,-96,-1,66,55,-54,85,-21,-75,122,-125,-12,-93,30,-22,-127,-14,85,94,104,13,87,6,-30,60,-99,-34,-124,-77,112,-112,-68,6,7,25,-65,-96,37,-70,-26,-117,26,30,-48,-88,13,122,-93,126,-52,-124,-12,24,-56,-74,97,-43,56,-114,-120,120,40,7,-47,-87,38,113,-7,-59,-18,-63,110,82,41,67,35,10,25,-97,-78,71,-46,58,41,29,104,-15,49,-45,-128,-54,48,-82,-47,-55,81,-60,-92,-97,-54,-1,22,-74,33,6,-51,-8,68,-79,11,-64,43,59,-69,-6,-69,17,53,-82,-43,14,-85,70,71,53,-70,113,57,-122,34,87,52,-93,-90,9,57,7,67,-47,63,115,-112,-53,122,3,105,-1,20,52,53,66,37,96,81,124,25,-95,25,-104,-116,84,68,30,85,64,98,42,100,125,3,23,-111,9,28,-80,-108,-117,4,-7,46,-14,-121,-47,-96,-106,115,120,124,-51,36,57,29,35,-33,-88,-42,24,121,-29,-102,49,18,-98,-81,-68,80,65,-114,-110,78,-50,-46,-71,42,-83,102,92,39,37,-57,74,10,-57,-64,81,-108,-21,67,-42,-117,49,-6,33,-39,5,33,93,54,-46,-118,110,-66,18,-56,52,55,83,-14,95,32,-93,-110,-80,90,32,29,17,-64,28,63,15,44,91,-2,17,-82,2,127,-118,-71,-67,-69,-73,83,-77,-119,-25,82,-60,126,-70,124,24,121,17,58,97,30,-76,8,-123,16,0,-109,-75,61,114,-121,-92,-120,16,107,111,-105,-96,29,-94,118,-119,68,-46,-42,38,-24,16,9,-56,23,-76,77,-64,76,80,40,96,32,72,-40,-68,79,-92,8,25,-76,-38,121,104,27,15,21,32,88,-69,84,-44,46,69,37,44,-125,-125,-112,-94,-96,41,-79,50,-119,70,-83,85,25,-115,114,-54,-43,-24,2,46,-41,50,25,11,46,77,-87,72,75,-90,17,44,-24,-119,-44,79,94,83,45,-45,-109,-120,-108,-118,-62,108,102,-98,42,38,-82,1,64,-89,-64,54,-3,42,107,30,41,55,-57,11,-20,-32,-61,8,-27,28,-14,-100,111,40,100,93,10,-32,1,-98,87,-74,-91,120,40,102,-111,-15,-69,20,36,-111,97,-120,23,-44,-26,-53,58,106,-40,-44,89,27,-49,-42,4,-50,-64,85,-79,114,79,27,3,127,-118,-8,118,-32,-108,-35,57,21,-69,-73,93,39,-21,-53,44,-106,3,-93,-101,-66,-26,-3,-35,29,-14,-17,-41,-96,45,18,-95,-19,24,-122,117,72,-38,80,33,38,18,-93,-104,-40,122,35,114,-80,-8,32,125,-51,122,-77,-74,-108,89,39,-106,-78,-3,84,-125,121,-71,54,-126,-15,120,-118,-47,80,11,-24,-107,92,-26,-113,34,39,-31,-19,-75,44,28,92,1,38,-58,67,-123,60,76,68,3,96,-46,51,-103,86,-31,100,-110,-64,85,-56,-118,9,-37,20,110,48,-22,73,43,-102,-96,103,109,-83,-78,7,33,108,-71,40,117,-73,-119,89,-69,49,17,76,-24,-92,-117,122,126,14,-101,-117,34,97,85,95,37,-74,103,47,113,-108,-79,47,31,65,124,46,106,-9,-20,65,-102,-55,96,46,-26,-95,29,60,-127,-80,113,110,-103,67,-25,-73,119,-81,-81,64,-106,38,-123,-13,-37,116,-68,-59,-36,-46,119,-26,-41,-96,-13,74,79,-41,-26,84,-79,-100,-41,61,67,-13,-10,-116,-29,-103,-25,14,52,86,-78,-58,-28,-41,-103,41,-111,-10,-100,-64,61,-65,-62,65,-64,-125,9,37,2,-127,80,-8,9,-7,-100,-47,112,28,-49,50,-55,36,17,123,2,33,-101,103,46,20,73,68,127,-59,-124,29,60,-75,126,-14,-11,-104,55,-71,-120,52,18,11,-56,-52,-42,-128,27,-115,-83,-113,6,18,49,-60,-97,51,-26,-12,-30,89,-122,0,-80,-68,-93,24,15,-84,-22,-82,-17,22,110,17,102,-33,108,32,68,-60,67,-121,-66,-39,-11,-105,-85,94,-49,-19,-24,-79,4,117,-121,-46,-33,108,4,-123,40,86,-113,-93,52,44,80,124,114,74,-85,-65,58,73,102,27,-83,-105,-87,72,88,43,-89,-86,5,0,68,92,87,-62,81,29,111,18,-114,92,-62,-44,40,-90,-21,90,-26,-40,-15,85,-44,3,25,20,-116,73,29,96,-51,-102,68,-50,24,124,-77,110,-21,-6,75,-33,44,97,73,-17,-72,-82,37,-29,-79,-121,-82,91,27,75,77,-57,-46,60,-17,-6,76,100,82,101,48,92,45,-39,5,4,2,-20,111,85,-22,86,-38,78,-123,-12,-118,27,45,9,105,9,-114,108,-62,-77,58,29,115,-124,55,106,-117,-67,12,49,-121,-28,-38,-119,85,-23,-117,-91,-104,67,-41,-37,-14,-63,66,-40,58,-109,-36,95,123,-78,113,-22,8,-82,125,21,122,82,44,-15,-44,-32,79,-91,25,-128,63,124,41,106,97,48,-39,-67,-19,121,-32,-2,15,-21,-70,3,-122,-33,-64,110,4,60,-104,-80,93,-48,-42,-47,81,99,-119,42,-57,43,-39,28,51,51,38,59,108,-52,-122,100,52,121,-44,-78,-99,-123,-33,-85,108,-89,41,-69,105,-127,-51,52,97,47,-83,-75,21,39,-31,51,123,96,-31,-94,-12,22,122,-111,-68,-37,-72,-83,-112,27,25,81,43,109,-123,-51,78,32,-15,72,-85,87,-23,84,83,83,-38,-85,103,-80,-102,-67,-67,37,4,-86,12,-11,-61,-6,-2,-101,88,66,56,-53,29,63,44,-89,3,114,-16,-100,-72,92,13,-122,98,-128,6,42,104,13,-42,1,0,-102,-17,-89,-123,-61,38,-48,82,126,-30,55,102,52,1,19,-38,-54,-93,-8,22,-69,-115,66,-47,50,-10,-51,-103,22,-82,78,112,-67,-28,107,-64,99,100,-46,-64,29,83,77,106,-76,87,-91,-105,52,-109,-67,-72,-122,83,44,6,-75,87,26,97,23,-71,83,-11,-3,-102,-16,56,-113,82,-2,96,54,-6,-80,-46,-106,-39,-94,70,-15,-91,-18,116,24,-60,15,114,40,90,-4,44,-46,-31,-73,59,-128,-8,60,-119,-52,-69,22,64,-38,24,-52,-34,25,74,64,22,-49,34,90,59,4,13,34,-9,-73,16,-98,85,127,81,-69,111,119,-3,123,96,43,54,-126,-8,77,106,54,-93,16,-43,17,25,-5,105,120,-101,-20,-84,78,31,-118,-87,-128,-104,-43,90,51,-121,-10,23,68,54,30,90,56,92,8,-109,116,-38,-64,-31,38,4,12,-116,35,115,127,-31,-112,97,28,-96,59,-7,-120,-79,59,62,-69,112,35,-27,-9,-72,-106,15,-91,8,90,29,89,-32,2,112,-40,-42,-17,36,31,-81,101,89,-40,-126,-78,27,0,1,-117,66,57,-27,74,-120,-75,44,-93,12,27,104,42,-116,-73,-66,32,8,-62,95,-45,-127,15,42,19,-70,43,-79,7,-65,-102,0,-94,55,11,-96,-95,-86,2,-80,-74,-40,97,16,118,-116,80,85,6,38,-109,-109,-64,41,-84,92,90,93,107,-52,123,65,29,-96,14,-85,-51,-70,-24,35,124,117,-128,46,79,123,-82,67,-118,-6,48,80,91,34,-99,-82,3,108,-47,18,57,113,-20,-44,-106,90,33,9,-64,104,85,16,-80,123,98,93,105,34,-121,-9,-78,68,124,-7,71,-80,58,101,-120,-71,19,-41,-3,-107,-125,66,-103,-124,53,-114,48,5,14,71,-6,-82,-101,-83,-112,34,-122,116,-122,55,2,63,-37,18,-112,14,122,93,-81,-119,98,-44,92,-20,-96,1,37,-125,-56,-24,116,111,127,3,-51,55,-85,-20,-116,-116,109,107,14,63,81,7,-24,90,54,120,-77,16,47,-21,49,75,107,-14,17,-96,-50,-112,-63,86,25,-47,82,-54,-97,-4,26,32,-44,107,117,69,-124,98,106,-51,26,-106,-103,20,-51,-44,-98,-14,67,26,97,-128,-80,-74,-36,1,-69,-128,39,16,-79,114,108,-56,12,-74,9,-49,117,-122,4,-67,74,-10,14,47,-47,-128,40,11,-32,12,123,-108,-86,40,66,91,-32,26,0,7,75,89,29,-32,43,-9,-68,107,13,-128,-45,23,-54,-38,70,0,82,-109,-26,-43,-43,-100,45,48,-73,53,-94,-2,98,88,20,40,4,34,-80,9,114,30,-25,50,19,-8,97,97,-107,-100,-128,-116,-124,24,87,-116,110,-2,24,-75,-69,-10,60,46,42,67,91,-14,-63,-50,-121,97,-72,98,-116,-37,-47,44,110,7,-58,-59,36,-51,34,83,-104,-119,84,36,-42,48,118,99,7,-79,37,-7,-14,-85,-98,-65,12,-110,-49,-7,51,-79,1,6,67,-92,127,-113,67,31,118,-35,9,-36,-8,23,42,-125,-118,-36,-71,-31,-17,-73,-80,-76,45,108,116,122,-29,52,-68,1,-46,-96,119,108,19,11,10,-39,-48,116,-112,33,31,101,-85,20,1,52,-122,-107,-123,-83,82,4,-48,-40,-85,96,-116,-125,-124,-99,-39,-4,47,-22,82,109,-107,102,65,90,-44,67,-120,77,33,8,-44,76,101,-115,28,-69,1,39,54,78,-31,106,-109,65,53,-6,-34,-119,-23,78,-68,-71,67,60,126,7,-21,80,-48,98,-81,119,-35,-17,93,-79,-89,-20,44,122,100,68,99,-81,17,-61,-100,10,108,-31,-102,-16,124,-37,19,-25,-81,-20,-123,108,70,110,53,-54,-26,48,-76,-64,113,-52,89,60,-11,111,77,-64,0,58,-111,85,80,107,77,89,59,-6,-80,-46,-102,-39,34,71,-2,103,29,-47,-61,-120,-85,12,-22,-119,-9,97,-125,22,54,-26,-10,-112,-69,-73,17,-17,58,-30,-9,-66,67,81,3,-70,-126,-125,111,-45,-73,-65,101,15,0,-19,-80,-72,81,-8,-88,-67,18,-115,-27,48,-100,3,112,-128,83,113,-22,-8,124,-126,-51,65,11,116,-22,88,-51,77,-93,10,-39,-27,92,-19,-24,-78,98,88,48,-100,59,-22,35,91,-53,97,74,31,-26,87,117,-107,-66,-112,-89,117,50,107,62,-49,80,-16,71,51,20,-2,-47,12,69,-81,-59,80,-52,-61,4,60,-16,13,91,37,-61,-6,-126,-38,40,-82,-42,-86,76,42,-109,70,-33,124,125,-6,-1,49,-78,57,-113,-112,-16,6,18,121,-123,4,-114,-33,-91,-56,6,-3,-30,-3,-71,59,-60,18,-45,96,-63,-112,38,61,36,-104,69,-62,15,-22,12,110,-31,-81,28,-65,112,34,-81,2,-57,84,112,115,4,-35,-39,-51,-17,27,10,104,5,-36,-6,107,19,66,-106,44,-125,-38,-34,62,4,-9,68,0,-35,66,54,65,-89,93,-97,-109,-23,-12,38,-115,-6,-3,-122,-125,-18,95,25,2,-119,-121,-112,-51,93,-124,88,122,-45,-4,-117,-47,98,-34,-64,-69,55,-48,13,12,67,-3,33,-89,-126,73,-51,-24,-88,-74,56,3,49,-52,123,55,119,-119,-91,96,-74,-38,105,107,-8,30,64,43,126,-55,83,-85,52,64,59,-120,2,-97,-95,-84,-66,-54,125,-122,82,-2,17,74,-107,-102,64,23,56,2,71,-28,8,6,-43,35,125,5,-82,-48,103,93,-98,58,-90,39,-43,123,6,119,98,-34,98,79,-75,-35,64,-100,79,-111,-83,31,16,91,-20,77,-13,84,-120,78,123,-117,-15,124,-96,115,-28,98,-33,32,-73,-65,-69,71,9,110,103,78,125,121,14,-55,55,-115,-28,-82,32,-125,-74,-68,-9,86,-50,89,-10,49,117,-77,51,21,92,88,-115,-17,-125,-81,-65,63,86,-28,-25,-34,43,4,92,-122,-95,76,-38,32,76,64,27,71,-127,-15,114,124,108,75,-128,-84,-17,-56,117,19,28,62,-126,124,47,-107,5,-65,92,-65,-51,111,-90,-29,115,-47,101,-81,117,102,-50,-29,8,36,3,-55,108,56,-22,-114,-126,-76,62,25,-40,90,-78,-50,36,-26,64,123,-20,121,-95,21,-32,110,-18,-70,110,-70,-73,66,-89,-2,5,-77,53,47,-40,-82,17,-123,-128,-121,0,38,-64,-127,19,43,75,15,124,59,-23,-43,-62,45,-43,-24,116,-38,-27,8,14,-10,-100,-65,84,-72,7,-68,13,86,53,-57,-42,124,58,-18,8,38,-29,-82,29,103,0,-84,118,-114,32,-72,25,12,124,-48,58,-29,-92,-2,77,101,65,11,-128,-50,13,-43,-26,1,-48,96,16,-18,45,-128,1,56,-112,-5,-112,8,-128,0,-83,115,17,-17,-19,57,75,48,18,-34,-121,113,-93,15,87,-56,11,63,115,-99,22,-60,-79,104,-119,-91,-23,55,-109,-63,-72,0,-1,100,60,-6,-62,58,83,-128,90,-33,79,-37,124,-55,-71,-81,-19,-49,-63,-73,-68,34,20,69,-123,-19,-62,-10,14,9,23,-117,61,47,-116,96,115,119,-2,40,-15,99,98,15,-124,-116,18,102,98,110,57,-110,118,58,-68,-44,-104,-105,-62,27,-101,-121,91,25,-13,2,-99,99,1,-121,-40,51,47,-50,89,54,119,125,-98,2,69,-30,-2,-54,-127,117,-90,-16,-26,-69,-27,124,-75,-12,32,-10,-56,-75,3,48,86,-113,-25,55,125,47,-29,113,-5,-41,43,7,-12,-39,-119,120,5,-8,-7,120,-56,97,-77,-50,-89,-41,-98,44,111,-71,-18,-103,45,-23,-8,-86,-59,-79,19,-11,-112,10,-73,-40,-84,-23,107,-66,91,-37,-113,19,-98,-44,108,-22,-71,107,-41,126,51,-103,-91,106,39,-33,101,-18,-101,45,-34,-92,-21,-102,-39,-78,125,-22,-114,57,-126,-31,91,57,-7,-45,121,-76,-15,114,102,-27,8,-90,95,102,-114,-61,55,-120,95,-110,-39,72,-52,109,-51,16,-28,-100,-14,-25,-11,-42,-103,-88,125,105,-106,-40,11,60,-115,31,44,71,114,70,-26,-76,-89,-41,72,-70,-45,126,-81,-39,-110,-103,78,-19,-72,-73,22,45,-74,-78,-47,-117,121,-56,-6,-2,86,38,-78,102,-77,-70,-18,-25,-104,-128,-31,102,44,-119,-57,54,107,-32,-66,-39,74,5,-125,-78,43,-14,-28,-30,-89,6,87,-28,-47,-78,11,-13,-59,-5,-14,29,32,-126,-46,-67,-83,-63,112,-102,67,-91,-82,-24,-77,92,-71,-92,-33,-86,-57,36,76,-105,-23,-13,4,72,-128,-118,49,-64,35,101,-15,-2,34,-32,87,41,-33,-38,-39,67,-39,-22,91,58,24,-109,117,34,19,6,124,76,-50,1,-1,-107,-123,-108,-49,-65,114,-27,10,-49,56,-95,-46,-115,79,-88,52,92,48,82,-75,126,-110,-89,-42,-15,43,-46,12,-26,-121,92,-58,-58,113,-109,-4,31,-105,-75,42,-35,103,-118,26,84,101,-4,-50,58,-18,-99,51,12,125,121,-53,115,125,-15,-9,-24,-49,-64,7,-83,110,-70,23,-78,70,-24,97,42,-124,83,102,-61,47,-34,74,-89,-2,-57,16,-6,-110,-4,95,80,75,7,8,78,-100,-76,13,-39,12,0,0,93,68,0,0,80,75,3,4,20,0,8,0,8,0,-28,-115,-94,74,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,105,109,97,103,101,115,47,3,0,80,75,7,8,0,0,0,0,2,0,0,0,0,0,0,0,80,75,3,4,20,0,8,0,8,0,-28,-115,-94,74,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,105,109,97,103,101,115,47,112,114,105,110,116,46,103,105,102,115,-9,116,-77,-80,76,20,102,16,100,120,-52,0,2,13,13,12,11,22,52,-4,-1,-33,112,-32,-64,-1,-1,12,12,10,-1,29,18,18,28,-2,31,0,114,29,26,26,-128,-30,-1,25,-112,-128,-30,63,73,-123,-118,-60,18,-67,-28,-4,92,5,-49,-36,-60,-12,84,5,-1,-126,-110,-52,-36,-52,-86,-44,34,5,6,29,-112,10,-112,-63,12,44,49,5,39,61,87,-17,-67,-47,-74,-41,-104,-9,-78,65,67,-36,-124,57,25,-121,10,69,103,-14,114,126,-48,77,-78,-43,-24,-22,56,-78,-71,-42,-101,-127,-59,-57,-116,-15,106,1,-109,99,-63,6,101,-81,30,-13,-90,-123,12,1,58,-107,-82,-73,-6,27,54,27,109,-12,127,-5,-16,-128,45,-61,-116,-77,51,3,50,-20,-108,-17,61,104,-43,116,117,-73,108,108,-40,83,-73,-2,-5,-113,-1,-30,-126,12,-42,0,80,75,7,8,21,-85,-16,21,-71,0,0,0,-60,0,0,0,80,75,3,4,20,0,8,0,8,0,-28,-115,-94,74,0,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,105,109,97,103,101,115,47,115,99,105,115,46,103,105,102,1,-34,0,33,-1,71,73,70,56,57,97,42,0,42,0,-111,0,0,-14,22,29,15,63,-102,-1,-1,-1,0,0,0,33,-7,4,0,0,0,0,0,44,0,0,0,0,42,0,42,0,0,2,-81,-108,-113,-87,-53,-19,15,-93,100,0,-52,75,-85,-59,92,104,-35,93,-33,23,70,-29,88,58,-25,-103,46,-21,-38,34,-17,27,123,51,-99,-34,119,-51,27,65,-14,-69,4,15,67,96,-32,40,64,34,-109,-57,-26,-46,-73,116,22,-95,77,68,-107,122,-91,26,-89,82,-59,83,90,116,26,-73,79,43,-79,123,-50,-6,-84,-24,6,-104,-35,38,-105,23,-17,116,29,-82,-90,-57,-63,98,-4,-36,27,-57,-60,23,22,8,-40,-25,119,40,-104,-73,-122,-11,-41,-104,117,103,-10,-24,22,89,-104,100,87,54,-91,40,-57,-123,-56,102,104,8,-55,-119,-9,73,-71,56,-104,-90,-88,-39,51,-95,-93,83,-30,-118,3,27,75,18,67,91,-47,67,-53,106,-77,-77,-53,11,-29,107,32,27,-4,-117,75,44,3,114,-100,96,-84,-84,92,0,0,59,80,75,7,8,67,-109,110,63,-29,0,0,0,-34,0,0,0,80,75,1,2,20,0,20,0,8,0,8,0,-28,-115,-94,74,78,-100,-76,13,-39,12,0,0,93,68,0,0,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,49,55,55,56,48,57,52,55,56,56,56,53,53,50,57,52,50,48,57,52,48,53,50,46,104,116,109,108,80,75,1,2,20,0,20,0,8,0,8,0,-28,-115,-94,74,0,0,0,0,2,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,36,13,0,0,105,109,97,103,101,115,47,80,75,1,2,20,0,20,0,8,0,8,0,-28,-115,-94,74,21,-85,-16,21,-71,0,0,0,-60,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,91,13,0,0,105,109,97,103,101,115,47,112,114,105,110,116,46,103,105,102,80,75,1,2,20,0,20,0,8,0,8,0,-28,-115,-94,74,67,-109,110,63,-29,0,0,0,-34,0,0,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,82,14,0,0,105,109,97,103,101,115,47,115,99,105,115,46,103,105,102,80,75,5,6,0,0,0,0,4,0,4,0,-5,0,0,0,114,15,0,0,0,0";
        writeFile(str);
    }

    /**
     * 查询方法
     * @param idCard 身份证号
     * @param name 客户姓名
     * @param plate 查询板式类型:1-机构版(金融版) 3-特殊交易版
     * @return {"RESULT_CODE":查询状态(OK-成功 ERR-失败), "MSG":返回消息, "CUSTOMER_ID":客户id, "VALUE":文件内容}
     * @throws Exception
     */
    public static Map<String, String> query(String idCard, String name, String plate) throws Exception {
        Map<String, String> resultMap = null;
        HttpClient httpClient = getUrlContent();
        PostMethod postMethod = new PostMethod(batchCreditWebServiceURI);
        postMethod.getParams().setParameter(HttpMethodParams.HTTP_CONTENT_CHARSET, "utf-8");
        postMethod.addRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        Document doc = DocumentHelper.createDocument();
        Element root = doc.addElement("soapenv:Envelope");
        root.add(new Namespace("soapenv", "http://schemas.xmlsoap.org/soap/envelope/"));
        root.addAttribute("xmlns:web", "http://webservice.creditreport.p2p.sino.com/");
        root.addElement("soapenv:Header");
        // 创建元素时需指定与父节点相同的命名空间,否则将生成XMLNS=""这样的属性,导致报错
        Element body = root.addElement(QName.get("soapenv:Body", root.getNamespace()));
        Element queryCredit = body.addElement(QName.get("web:queryCredit", body.getNamespace()));
        queryCredit.addElement("orgcode").addCDATA(ServerConfig.NFCS_ORG_CODE);
        queryCredit.addElement("secret").addCDATA(ServerConfig.NFCS_SSECRET);
        queryCredit.addElement("plate").addCDATA(plate);
        queryCredit.addElement("certtype").addCDATA("0"); // 证件类型，0-身份证
        queryCredit.addElement("certno").addCDATA(idCard);
        queryCredit.addElement("name").addCDATA(name);
        queryCredit.addElement("reason").addCDATA("02"); // 查询原因：01-贷后管理 02-贷款审批 04-担保资格审查 05-异议查询 06-本人查询 07-司法调查
                                                         // 08-金融监管
        queryCredit.addElement("createtype").addCDATA("0"); // 返回值类型 0-html格式 (压缩包) 1-xml
        postMethod.setRequestBody(doc.asXML());
        httpClient.executeMethod(postMethod);
        String result = postMethod.getResponseBodyAsString();
        if (StringUtils.isNotEmpty(result)) {
            // 将获取结果转换为字符串，并生成压缩文件
            Element el = XMLUtil.getRootElement(result);
            JSONArray arr = JSONArray.fromObject(el.getStringValue());
            if (arr.size() > 0) {
                resultMap = new HashMap<String, String>();
                JSONObject jsonObject = JSONObject.fromObject(arr.get(0));
                if (jsonObject.get("errors") == null) {
                    Object obj = jsonObject.get("result");
                    String resultStr = "";
                    if (obj == null || StringUtils.isBlank(obj.toString())) {
                        resultMap.put("RESULT_CODE", "ERR");
                        resultMap.put("VALUE", "被查询人不存在");
                    } else {
                        resultStr = obj.toString();
                        resultStr = resultStr.replace("[", "").replace("]", "");
                        resultMap.put("RESULT_CODE", "OK");
                        resultMap.put("CUSTOMER_ID", idCard);
                        resultMap.put("VALUE", resultStr);
                    }
                } else {
                    resultMap.put("RESULT_CODE", "ERR");
                    resultMap.put("MSG", jsonObject.get("errors").toString());
                }
            }
        }
        return resultMap;
    }

    public static String writeFile(String str) throws IOException {
        String[] strArr = org.apache.commons.lang.StringUtils.split(str, ",");
        int[] intArr = new int[strArr.length];
        for (int i = 0; i < strArr.length; i++) {
            intArr[i] = Integer.parseInt(strArr[i]);

        }
        byte[] bytes = new byte[0];
        for (int i = 0; i < intArr.length; i++) {
            bytes = ArrayUtils.add(bytes, (byte) (intArr[i]));
        }

        String fileName = new Date().getTime() + FILE_EXTENSION;

        OutputStream out = new FileOutputStream("D:" + File.separator + fileName);
        out.write(bytes);
        out.close();

        return fileName;
    }
}