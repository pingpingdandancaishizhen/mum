<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.sunfit.risk.buz.server.dao.p2p.productSubType.ProductSubTypeDAO" >
  <resultMap id="BaseResultMap" type="cn.sunfit.risk.buz.api.beans.p2p.ProductSubType" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="type_id" property="typeId" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, name, type_id
  </sql>
  <select id="selectByProductCode" resultMap="BaseResultMap"  >
  SELECT s.id,s.name,s.type_id from ${domain}_p2p_product p JOIN p2p_product_type t  ON p.product_type=t.id and t.is_active=1 
  JOIN p2p_product_sub_type s  on t.id=s.type_id where p.product_code=#{productCode,jdbcType=VARCHAR}   
  </select>
  
  <select id="selectByTypeId" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from p2p_product_sub_type
    where type_id = #{typeId,jdbcType=VARCHAR}
  </select>
  
  <select id="getProductSubTypes" resultType="java.util.Map">
  	SELECT sub.id id,sub.name name
  	FROM p2p_product_sub_type sub
  	LEFT JOIN ${domain}_p2p_product product ON product.product_type = sub.type_id
	WHERE product.product_code = #{productCode}
  </select>
  
  <select id="getByName" resultMap="BaseResultMap" >
  	SELECT sub.id id, sub.name name, sub.type_id type_id 
  	FROM p2p_product_sub_type sub
	LEFT JOIN p2p_product_type type ON sub.type_id = type.id
	LEFT JOIN ${domain}_p2p_product product ON type.id = product.product_type
	WHERE product.product_code = #{productCode}
	AND sub.`name` = #{subTypeName}
	LIMIT 1;
  </select>
  
</mapper>