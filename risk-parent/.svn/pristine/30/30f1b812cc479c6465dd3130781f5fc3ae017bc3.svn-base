<template>
  <div>
    <div v-if="examineData">
      <div class="form-group col-md-3" v-if="repaymentTypesLinkSFP.hasRepaymentTypes" :id="data.key+'_repaymentTypes'">
        <label :class="data.required?'require':''">还款方式</label>
        <div class="input-group">
          <select name="repaymentTypes" class="form-control" v-model="repaymentTypes1" :disabled="data.readonly?true:false">
            <option value="">请选择还款方式</option>
            <option v-for="item in examineData.repaymentTypes" :value="item.repaymentType">{{item.repaymentTypeName}}</option>
          </select>
        </div>
      </div>
      <div class="form-group col-md-3" v-if="monthlyTermLinkMonthAndYearRate.hasmonthlyTerm" >
        <label :class="data.required?'require':''">借款期限</label>
        <div class="input-group" v-if="monthlyTermLinkMonthAndYearRate.hasmonthlyTerm=='select'" :id="data.key+'_monthlyTerm'">
          <select name="monthlyTerm" class="form-control" v-model="monthlyTerm1" :disabled="data.readonly?true:false">
            <option value="">请选择借款期限</option>
            <option v-for="item in examineData.monthlyFee" :value="item.term">{{item.termText}}</option>
          </select>
        </div>
        <div class="input-group" v-if="monthlyTermLinkMonthAndYearRate.hasmonthlyTerm=='input'" :id="data.key+'_daylyTerm'">
          <input type="text" name="daylyTerm" class="form-control" v-model.lazy="daylyTerm1" :disabled="data.readonly?true:false">
          <span  class=" input-group-addon">天</span>
        </div>
      </div>

      <div class="form-group col-md-3" :id="data.key+'_eachTimes'" v-if="monthlyTermLinkMonthAndYearRate.hasEachTimes">
        <label :class="data.required?'require':''">每期期长</label>
        <div class="input-group">
          <select name="eachTimes" class="form-control" v-model="eachTimes1" :disabled="data.readonly?true:false">
            <option value="">请选择每期期长</option>
            <option v-for="item in examineData.eachTimes" :value="item.eachTime">{{item.eachTimeName}}</option>
          </select>
        </div>
      </div>
      <div class="form-group col-md-3" v-if="repaymentTypesLinkSFP.hasSupportFirstPay" :id="data.key+'_supportFirstPay'">
        <label :class="data.required?'require':''">首还款支付方式</label>
        <div class="input-group">
          <select name="supportFirstPay" class="form-control" v-model="supportFirstPay1" :disabled="data.readonly?true:false">
            <option value="">请选择首还款支付方式</option>
            <option  v-for="item in repaymentTypesLinkSFP.supportFirstPay" :value="item.payType">{{item.payName}}</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</template>
<style>

</style>
<script>
  import {mapGetters} from 'vuex';
  import * as api from '../api';
  var setDefaultData= {
    repaymentTypes: '',//还款方式
    monthlyTerm:'',//申请期限
    eachTimes: '',//每期期长
    supportFirstPay: '',//首付款支付方式
    daylyTerm:'',//日审批期限
  }
    export default{
        data(){
          var temp={}
          for(var key in setDefaultData){
            var item=setDefaultData[key];
            temp[key+'1']=item;
          }
            return temp
        },
      props: ['data'],
      created:function () {
          //默认值
        var attrsData=this.attrsData;
        for(var key in setDefaultData){
          var data_key=[this.data.key,key].join('_');
          if(attrsData.hasOwnProperty(data_key)){
            var attrValue=attrsData[data_key];
            var deAttrDataValue=attrValue ? (attrValue.draftValue==null?(attrValue.attrValue||''):attrValue.draftValue) : '';
            this[key+'1']=deAttrDataValue;
            this.$store.dispatch('setInputData', {key: data_key, value:deAttrDataValue});
          }
        };
        this.getData();
      },
      computed:{
        ...mapGetters({
          'attrsData':'attrsData',
          'examineData':'examineData',
          'hiddenData': 'defaultHiddenData',
          'rulesData': 'rulesData'
        }),
          //还款方式和首付支付方式关联
        repaymentTypesLinkSFP(){
          var linkItem={};
          var data=this.examineData||{};
          if('repaymentTypes' in data){
            linkItem['hasRepaymentTypes']=true;
          }
          var repaymentTypes=data.repaymentTypes||[];
          var temRepaymentTypes={};
          for(let k in repaymentTypes){
            var item=repaymentTypes[k];
            temRepaymentTypes[item.repaymentType]=repaymentTypes[k];
          }
          var supportFirstPayItem=temRepaymentTypes[this.repaymentTypes1];
          if(supportFirstPayItem){
            var supportFirstPayArr=supportFirstPayItem.supportFirstPay||[];
            if(supportFirstPayArr.length>0){
              linkItem['hasSupportFirstPay']=true;
            }
            linkItem['supportFirstPay']=supportFirstPayItem.supportFirstPay||[];

          }else{
            linkItem['hasSupportFirstPay']=false;
          }
          return linkItem
        },
        //审批期限
        monthlyTermLinkMonthAndYearRate(){
          var linkItem={
            hasmonthlyTerm:false,
            showRateType:''
          };
          var dataKey=this.data.key;
          var reTypesValue=this.repaymentTypes1;
          if(reTypesValue!='') {
            if (reTypesValue == 3) {
              linkItem.hasmonthlyTerm='input'
              linkItem.showRateType = 'day';
              linkItem.hasEachTimes=false;

              var setInputData=[
                {key:dataKey+'_repaymentTypes',value:this.repaymentTypes1},
                {key:dataKey+'_daylyTerm',value:this.daylyTerm1},
                {key:dataKey+'_supportFirstPay',value:this.supportFirstPay1},
              ];
              this.$store.dispatch('setInputData', setInputData);
              this.$store.dispatch('delInputData',[this.data.key+'_monthlyTerm',this.data.key+'_eachTimes'])
            } else {
              linkItem.showRateType = 'month';
              linkItem.hasmonthlyTerm='select';
              linkItem.hasEachTimes=true;
              var setInputData=[
                {key:dataKey+'_repaymentTypes',value:this.repaymentTypes1},
                {key:dataKey+'_monthlyTerm',value:this.monthlyTerm1},
                {key:dataKey+'_eachTimes',value:this.eachTimes1},
                {key:dataKey+'_supportFirstPay',value:this.supportFirstPay1},
              ];
              this.$store.dispatch('setInputData', setInputData);
              this.$store.dispatch('delInputData',this.data.key+'_daylyTerm')
            }
          }

          return linkItem;
        },
      },
      watch: {
        monthlyTerm1:function (value) {
          var dataKey=this.data.key;
          this.$store.dispatch('setInputData', {key:dataKey+'_monthlyTerm',value:value},);
        },
        repaymentTypes1: function (value) {
          var dataKey=this.data.key;
          this.$store.dispatch('setInputData', {key:dataKey+'_repaymentTypes',value:value},);
        },
        eachTimes1: function (value) {
          var dataKey=this.data.key;
          this.$store.dispatch('setInputData', {key:dataKey+'_eachTimes',value:value},);
        },
        supportFirstPay1: function (value) {
          var dataKey=this.data.key;
          this.$store.dispatch('setInputData', {key:dataKey+'_supportFirstPay',value:value},);
        },
        daylyTerm1:function (value) {
          var dataKey=this.data.key;
          this.$store.dispatch('setInputData', {key:dataKey+'_daylyTerm',value:value},);
        },
      },
      methods:{
        //获取高审数据
        getData:function () {
          var options={
            url:'/data/getFeeConfig',
            method:'get',
            data:{
              productId:this.hiddenData.productId
            }
          };
          //获取表单数据
          this.$store.dispatch('getExamineData',options);
        }
      }
    }
</script>
