<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.sunfit.risk.buz.server.dao.api.jfjd.JFProductDAO" >
  <resultMap id="ProductResultMap" type="cn.sunfit.risk.buz.api.beans.api.jfjd.JFProductShowVO" >
    <result column="id" property="id"/>
    <result column="name" property="name"/>
  </resultMap>
  
  <resultMap id="BaseResultMap" type="cn.sunfit.risk.buz.api.beans.api.jfjd.JFProduct" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="product_name" property="productName" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="lastmod_time" property="lastmodTime" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="desc" property="desc" jdbcType="VARCHAR" />
    <result column="product_type" property="productType" jdbcType="VARCHAR" />
    <result column="medium" property="medium" jdbcType="VARCHAR" />
     <result column="fee_config" property="feeConfig" jdbcType="VARCHAR" />
     <result column="requirements" property="requirements" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    id, product_name, create_time, lastmod_time, status, `desc`,product_type,medium,requirements
  </sql>
  
  <select id="queryProducts" resultMap="ProductResultMap" parameterType="string">
  	select a.id id, a.product_name `name`
  	from risk_product as a
  	left join risk_corp_product_ref as b on a.id = b.product_id
  	where a.`status` = '1'
  		and b.corp_id = #{corpId}
  		and a.jf_support = '1';
  </select>
  
  <select id="selectById" resultMap="BaseResultMap" parameterType="string" >
    select
    <include refid="Base_Column_List" />
    from risk_product
    where id = #{id} and jf_support='1'
  </select>
  <select id="selectFeeConfigById" resultType="string" parameterType="string">
    select fee_config from risk_product
    where id = #{id}
  </select>
  <select id="selectMeta" resultType="cn.sunfit.risk.buz.api.beans.api.jfjd.JFMetaDTO" parameterType="java.util.Map">
      select 
    m.bp_def_id bpDefId,m.bp_def_key bpDefKey
    from ${domain}_bp_meta m left join risk_product p on m.product_key=p.id left join risk_corp c on m.corp_id = c.id
    where 1=1 
    and m.product_key=#{productId}  
     and m.latest=1 
     and p.product_type=m.loan_type
  </select>
  
    <select id="selectPartner" resultType="cn.sunfit.risk.buz.api.beans.api.jfjd.JFIdNameVO" parameterType="java.util.Map" >
      	select a.id as id,a.`name` as `name`,r.name as roleName,r.id as roleId
	from ${domain}_contract_partner as a 
		left join ${domain}_partner_product_rel as b 
			on a.id = b.partner_id left join ${domain}_contract_partner_role r on b.role_id=r.id
	where b.product_id = #{productId}
		and a.del_flag = 0
		 and b.role_id = #{roleId}
  </select>
  
  <select id="selectCountByIdForJF" resultType="int" parameterType="string" >
    select count(*) from risk_product
    where id = #{id} and jf_support = '1';
  </select>
</mapper>